<!DOCTYPE html>
<html>
<head>
	<!-- jQuery -->
	{% load staticfiles %}

	<!-- Application CSS -->
	<link rel="stylesheet" href="{% static "css/mattsboots.css" %}">
	<link rel="stylesheet" href="{% static "css/chat.css" %}">
	<script src="http://codeorigin.jquery.com/jquery-2.0.3.min.js"></script>

	<script type="text/javascript" src="http://static.opentok.com/webrtc/v2.0/js/TB.min.js"></script>




</head>


<body>
	<div class="head">
		<h1 class="chat-header">Chat & Discuss {{ movie_name }}</h1>
	</div>

	<div class="container">
		<div class="row">
			<div class="span6">
				<a class="chat-movie-img" href={{ movie_pic_url }}>
					<img id="movie0" class="movie" src={{ movie_pic_url }} alt="movie-placeholder" title="placeholder"/>
				</a>
				<h1 class="section-head snr">Scores / Ratings:</h1>
				<div class="aud score">Audience Score: {{aud_score}}</div>
				<div class="crit score">Critics Score: {{crit_score}}</div>
				<div class="line"></div>
				
				<h1 class="section-head">US?</h1>
				{% if movie.is_american %}
				<div class="aud score">Aww yeah!</div>
				{% else %}
				<div class="aud score">Oh no!</div>
				{% endif %}

				<div class="line"></div>
				<h1 class="section-head">What People Say:</h1>
				<div class="movie-critic">{{ movie.critic1 }} says..</div>
				<div class="movie-critic">"{{ movie.quotes1 }}"</div>
				<div class="movie-critic">{{ movie.critic2 }} says..</div>
				<div class="movie-critic">"{{ movie.quotes2 }}"</div>
				<div class="movie-critic">{{ movie.critic3 }} says..</div>
				<div class="movie-critic">"{{ movie.quotes3 }}"</div>
			</div>
			<div class="span6">
				<h1 class="chattext">Good Looking You:</h1>
				<div id="myPublisherDiv"></div>
				<h1 class="chattext">Ugly Everyone Else:</h1>
				<span id="others">
				</span>
				<script type="text/javascript">
		          // Initialize API key, session, and token...
		          // Think of a session as a room, and a token as the key to get in to the room
		          // Sessions and tokens are generated on your server and passed down to the client
		          var apiKey = "40527392";
		          var sessionId = "1_MX40MDUyNzM5Mn4xMjcuMC4wLjF-U2F0IFNlcCAwNyAyMTozMjoyMCBQRFQgMjAxM34wLjA5MjA1MTc0NH4";
		          var token = "T1==cGFydG5lcl9pZD00MDUyNzM5MiZzZGtfdmVyc2lvbj10YnJ1YnktdGJyYi12MC45MS4yMDExLTAyLTE3JnNpZz0wMGM1YTgwNzYzZjE1OTY1NDQwNTI5ZmQwMmI1ZGMxNDhkMGM3NDQ3OnJvbGU9cHVibGlzaGVyJnNlc3Npb25faWQ9MV9NWDQwTURVeU56TTVNbjR4TWpjdU1DNHdMakYtVTJGMElGTmxjQ0F3TnlBeU1Ub3pNam95TUNCUVJGUWdNakF4TTM0d0xqQTVNakExTVRjME5INCZjcmVhdGVfdGltZT0xMzc4NjE0NzQ0Jm5vbmNlPTAuNTcyODk4MjMwOTgyMTIyMiZleHBpcmVfdGltZT0xMzc4NzAxMTQ0JmNvbm5lY3Rpb25fZGF0YT0=";


		          var publisher = TB.initPublisher(apiKey, 'myPublisherDiv');

		          var session = TB.initSession(sessionId);
		          session.connect(apiKey, token);
		          var session = TB.initSession(sessionId);

		          session.addEventListener('sessionConnected', function(e){
		          	console.log("Connected to the session");
		          	session.publish( publisher );

		          	for (var i = 0; i < e.streams.length; i++) {
		          		if (e.streams[i].connection.connectionId == session.connection.connectionId) {
		          			return;
		          		}

		          		console.log("Connected to someone");
		          		session.subscribe(e.streams[i]);

   						// Create the div to put the subscriber element in to
   						var div = document.createElement('div');
   						div.setAttribute('id', 'stream' + e.streams[i].streamId);
   						document.body.appendChild(div);
   						session.subscribe(e.streams[i], div.id);
   					}	

   				});

		          session.addEventListener('streamCreated', function(e){
		          	console.log("Stream created");
		          	for (var i = 0; i < e.streams.length; i++) {

    					// Make sure we don't subscribe to ourself
    					if (e.streams[i].connection.connectionId == session.connection.connectionId) {
    						return;
    					}
    					console.log("Subsribed to someone");
					    // Create the div to put the subscriber element in to
					    var div = document.createElement('div');
					    div.setAttribute('id', 'stream' + e.streams[i].streamId);
					    document.body.appendChild(div);
					    session.subscribe(e.streams[i], div.id);
					}
				});


		          session.connect(apiKey, token);




		          </script>				  
		      </div>

		  </div>
		</div>
	</body>
	</html>